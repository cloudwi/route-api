---
openapi: 3.0.1
info:
  title: Route API
  version: v1
  description: 커플 일기 관리 API - 커플 연결, 일기 작성 및 공유
paths:
  "/api/health":
    get:
      summary: 기본 헬스체크
      tags:
      - Health
      description: 서버가 정상적으로 응답 가능한지 확인합니다
      responses:
        '200':
          description: 서버 정상
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  service:
                    type: string
                    example: Route API
  "/api/health/detailed":
    get:
      summary: 상세 헬스체크
      tags:
      - Health
      description: 데이터베이스 연결 상태를 포함한 상세한 서버 상태를 확인합니다
      responses:
        '200':
          description: 모든 시스템 정상
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                  service:
                    type: string
                  checks:
                    type: object
                    properties:
                      database:
                        type: object
                        properties:
                          status:
                            type: string
                          message:
                            type: string
        '503':
          description: '시스템 오류 (예: DB 연결 실패)'
  "/api/v1/couple":
    get:
      summary: 커플 정보 조회
      tags:
      - Couple
      description: 현재 로그인한 사용자의 커플 정보를 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: 커플 ID
                  partner:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      email:
                        type: string
                      profileImage:
                        type: string
                        nullable: true
                  createdAt:
                    type: string
                    format: date-time
        '404':
          description: 커플 관계 없음
        '401':
          description: 인증 실패
    delete:
      summary: 커플 관계 해제
      tags:
      - Couple
      description: 현재 커플 관계를 해제합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 해제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Successfully disconnected from couple
        '404':
          description: 커플 관계 없음
        '401':
          description: 인증 실패
        '500':
          description: 서버 오류
  "/api/v1/couple_invitations":
    post:
      summary: 커플 초대 링크 생성
      tags:
      - Couple
      description: 커플 연결을 위한 초대 링크를 생성합니다. 이미 커플이면 생성 불가합니다.
      security:
      - bearer_auth: []
      responses:
        '201':
          description: 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: 초대 토큰
                  expiresAt:
                    type: string
                    format: date-time
                    description: 만료 시간
                  inviteUrl:
                    type: string
                    description: 초대 수락 URL
        '422':
          description: 이미 커플 관계임
        '401':
          description: 인증 실패
        '500':
          description: 서버 오류
  "/api/v1/couple_invitations/{token}/accept":
    parameters:
    - name: token
      in: path
      description: 초대 토큰
      required: true
      schema:
        type: string
    post:
      summary: 커플 초대 수락
      tags:
      - Couple
      description: 초대 링크로 커플 관계를 생성합니다
      security:
      - bearer_auth: []
      responses:
        '201':
          description: 커플 연결 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  couple:
                    type: object
                    properties:
                      id:
                        type: integer
                      partnerId:
                        type: integer
                      partnerName:
                        type: string
                      createdAt:
                        type: string
                        format: date-time
        '404':
          description: 초대 링크 없음
        '422':
          description: 유효성 검증 실패 (만료됨, 이미 사용됨, 본인 초대, 이미 커플 등)
        '401':
          description: 인증 실패
        '500':
          description: 서버 오류
  "/api/v1/diaries":
    get:
      summary: 일기 목록 조회
      tags:
      - 일기
      description: 현재 로그인한 사용자의 일기 목록을 조회합니다 (작성한 일기 + 공유받은 일기)
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      description: 일기 ID
                    title:
                      type: string
                      description: 일기 제목
                    thumbnailImage:
                      type: string
                      nullable: true
                      description: 썸네일 이미지 URL
                    author:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: 작성자 ID
                        name:
                          type: string
                          description: 작성자 이름
                    isOwner:
                      type: boolean
                      description: 소유자 여부
                    createdAt:
                      type: string
                      format: date-time
                      description: 생성일시
        '401':
          description: 인증 실패
    post:
      summary: 일기 생성
      tags:
      - 일기
      description: 새로운 일기를 생성합니다. 썸네일 이미지는 multipart/form-data로 전송합니다.
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '201':
          description: 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  title:
                    type: string
                  content:
                    type: string
                  thumbnailImage:
                    type: string
                    nullable: true
                    description: 썸네일 이미지 URL
                  author:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      profileImage:
                        type: string
                        nullable: true
                  isOwner:
                    type: boolean
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
        '422':
          description: 유효성 검증 실패
        '401':
          description: 인증 실패
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                diary[title]:
                  type: string
                  description: 일기 제목
                diary[content]:
                  type: string
                  description: 일기 내용
                thumbnail_image:
                  type: string
                  format: binary
                  description: 썸네일 이미지 파일 (옵션)
              required:
              - diary[title]
  "/api/v1/diaries/{id}":
    parameters:
    - name: id
      in: path
      description: 일기 ID
      required: true
      schema:
        type: integer
    get:
      summary: 일기 상세 조회
      tags:
      - 일기
      description: 특정 일기의 상세 정보를 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  title:
                    type: string
                  content:
                    type: string
                  thumbnailImage:
                    type: string
                    nullable: true
                    description: 썸네일 이미지 URL
                  author:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      profileImage:
                        type: string
                        nullable: true
                  isOwner:
                    type: boolean
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
        '404':
          description: 일기 없음
        '401':
          description: 인증 실패
    patch:
      summary: 일기 수정
      tags:
      - 일기
      description: 일기를 수정합니다. 소유자만 수정 가능합니다.
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  title:
                    type: string
                  content:
                    type: string
                  thumbnailImage:
                    type: string
                    nullable: true
                    description: 썸네일 이미지 URL
                  author:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      profileImage:
                        type: string
                        nullable: true
                  isOwner:
                    type: boolean
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
        '403':
          description: 권한 없음
        '404':
          description: 일기 없음
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                diary[title]:
                  type: string
                  description: 일기 제목
                diary[content]:
                  type: string
                  description: 일기 내용
                thumbnail_image:
                  type: string
                  format: binary
                  description: 썸네일 이미지 파일 (옵션, 새 이미지로 교체)
                delete_thumbnail_image:
                  type: boolean
                  description: 썸네일 이미지 삭제 여부 (옵션)
    delete:
      summary: 일기 삭제
      tags:
      - 일기
      description: 일기를 삭제합니다. 소유자만 삭제 가능합니다.
      security:
      - bearer_auth: []
      responses:
        '204':
          description: 삭제 성공
        '403':
          description: 권한 없음
        '404':
          description: 일기 없음
servers:
- url: http://localhost:3000
  description: Development server
- url: https://{defaultHost}
  variables:
    defaultHost:
      default: api.example.com
  description: Production server
components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
