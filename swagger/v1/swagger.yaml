---
openapi: 3.0.1
info:
  title: Route API
  version: v1
  description: 장소 검색, 코스 관리, 폴더 관리 API
paths:
  "/api/v1/courses":
    get:
      summary: 코스 목록 조회
      tags:
      - 코스 관리
      description: 현재 로그인한 사용자의 모든 코스를 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      description: 코스 ID
                    name:
                      type: string
                      description: 코스 이름
                    places:
                      type: array
                      items:
                        "$ref": "#/components/schemas/Place"
                    createdAt:
                      type: string
                      format: date-time
                      description: 생성일시
                  required:
                  - id
                  - name
                  - places
                  - createdAt
        '401':
          description: 인증 실패
    post:
      summary: 코스 생성
      tags:
      - 코스 관리
      description: 새로운 코스를 생성합니다
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '201':
          description: 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: 코스 ID
                  name:
                    type: string
                    description: 코스 이름
                  places:
                    type: array
                    items:
                      "$ref": "#/components/schemas/Place"
                  createdAt:
                    type: string
                    format: date-time
                    description: 생성일시
                required:
                - id
                - name
                - places
                - createdAt
        '401':
          description: 인증 실패
        '422':
          description: 유효성 검사 실패
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: 코스 이름
                places:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        description: 네이버 장소 ID
                      name:
                        type: string
                        description: 장소명
                      address:
                        type: string
                        description: 지번 주소
                      roadAddress:
                        type: string
                        description: 도로명 주소
                      lat:
                        type: number
                        description: 위도
                      lng:
                        type: number
                        description: 경도
                      category:
                        type: string
                        description: 카테고리
                      telephone:
                        type: string
                        description: 전화번호
                      naverMapUrl:
                        type: string
                        description: 네이버 지도 URL
                    required:
                    - name
                    - lat
                    - lng
              required:
              - name
              - places
  "/api/v1/courses/{id}":
    parameters:
    - name: id
      in: path
      description: 코스 ID
      required: true
      schema:
        type: integer
    get:
      summary: 코스 상세 조회
      tags:
      - 코스 관리
      description: 특정 코스의 상세 정보를 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  places:
                    type: array
                    items:
                      "$ref": "#/components/schemas/Place"
                  createdAt:
                    type: string
                    format: date-time
        '404':
          description: 코스 없음
    delete:
      summary: 코스 삭제
      tags:
      - 코스 관리
      description: 코스를 삭제합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 삭제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '404':
          description: 코스 없음
  "/api/v1/courses/{id}/directions":
    parameters:
    - name: id
      in: path
      description: 코스 ID
      required: true
      schema:
        type: integer
    get:
      summary: 코스 경로 검색
      tags:
      - 코스 관리
      description: 코스 내 장소들 간의 경로를 검색합니다. A → B → C 코스라면 A→B, B→C 경로를 모두 반환합니다.
      security:
      - bearer_auth: []
      parameters:
      - name: mode
        in: query
        required: true
        enum:
        - transit
        - driving
        description: "이동 수단 (transit: 대중교통, driving: 자동차):\n * `transit` \n * `driving`
          \n "
        schema:
          type: string
      responses:
        '200':
          description: 경로 검색 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  course_id:
                    type: integer
                    description: 코스 ID
                  course_name:
                    type: string
                    description: 코스 이름
                  mode:
                    type: string
                    description: 이동 수단
                  total_segments:
                    type: integer
                    description: 총 구간 수
                  segments:
                    type: array
                    description: 구간별 경로 정보
                    items:
                      type: object
                      properties:
                        segment:
                          type: integer
                          description: 구간 번호
                        from:
                          type: object
                          properties:
                            name:
                              type: string
                            lat:
                              type: number
                            lng:
                              type: number
                        to:
                          type: object
                          properties:
                            name:
                              type: string
                            lat:
                              type: number
                            lng:
                              type: number
                        route:
                          type: object
                          description: 경로 상세 정보
                  summary:
                    type: object
                    description: 전체 경로 요약
                    properties:
                      total_time:
                        type: integer
                        description: "[대중교통] 총 소요시간 (분)"
                      total_time_text:
                        type: string
                        description: "[대중교통] 총 소요시간 텍스트"
                      total_distance:
                        type: integer
                        description: 총 거리 (m)
                      total_distance_text:
                        type: string
                        description: 총 거리 텍스트
                      total_payment:
                        type: integer
                        description: "[대중교통] 총 요금"
                      total_duration_minutes:
                        type: number
                        description: "[자동차] 총 소요시간 (분)"
                      total_toll_fare:
                        type: integer
                        description: "[자동차] 총 통행료"
                      total_fuel_price:
                        type: integer
                        description: "[자동차] 총 유류비"
                required:
                - course_id
                - course_name
                - mode
                - total_segments
                - segments
                - summary
        '400':
          description: 잘못된 이동 수단
        '404':
          description: 코스 없음
        '422':
          description: 장소가 2개 미만
  "/api/v1/directions":
    get:
      summary: 경로 검색
      tags:
      - 경로 검색
      description: 대중교통(ODsay) 또는 자동차(Naver Directions) 경로를 검색합니다
      security:
      - bearer_auth: []
      parameters:
      - name: start_lat
        in: query
        required: true
        description: '출발지 위도 (예: 37.5546)'
        schema:
          type: number
      - name: start_lng
        in: query
        required: true
        description: '출발지 경도 (예: 126.9706)'
        schema:
          type: number
      - name: end_lat
        in: query
        required: true
        description: '도착지 위도 (예: 37.4979)'
        schema:
          type: number
      - name: end_lng
        in: query
        required: true
        description: '도착지 경도 (예: 127.0276)'
        schema:
          type: number
      - name: mode
        in: query
        required: true
        enum:
        - transit
        - driving
        description: "이동 수단 (transit: 대중교통, driving: 자동차):\n * `transit` \n * `driving`
          \n "
        schema:
          type: string
      - name: path_type
        in: query
        required: false
        enum:
        - 0
        - 1
        - 2
        description: "[대중교통] 경로 유형 (0: 모두, 1: 지하철, 2: 버스)"
        schema:
          type: integer
      - name: route_option
        in: query
        required: false
        enum:
        - fastest
        - comfortable
        - optimal
        - avoid_toll
        - avoid_car_only
        description: "[자동차] 경로 옵션 (fastest: 빠른길, comfortable: 편한길, optimal: 최적, avoid_toll:
          무료우선, avoid_car_only: 자동차전용도로 회피)"
        schema:
          type: string
      - name: car_type
        in: query
        required: false
        enum:
        - 1
        - 2
        - 3
        - 4
        - 5
        - 6
        description: "[자동차] 차량 타입 (1: 일반, 2: 소형, 3: 중형, 4: 대형, 5: 이륜, 6: 경차)"
        schema:
          type: integer
      - name: waypoints
        in: query
        required: false
        description: '[자동차] 경유지 JSON 배열 (예: [{"lat":37.52,"lng":127.0}], 최대 5개)'
        schema:
          type: string
      responses:
        '200':
          description: 자동차 경로 검색 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  mode:
                    type: string
                    description: 이동 수단
                  start:
                    type: object
                    properties:
                      lat:
                        type: number
                        description: 출발지 위도
                      lng:
                        type: number
                        description: 출발지 경도
                  destination:
                    type: object
                    properties:
                      lat:
                        type: number
                        description: 도착지 위도
                      lng:
                        type: number
                        description: 도착지 경도
                  result:
                    type: object
                    description: 경로 검색 결과 (mode에 따라 구조가 다름)
                    properties:
                      search_type:
                        type: integer
                        description: "[대중교통] 검색 유형"
                      count:
                        type: integer
                        description: "[대중교통] 경로 수"
                      paths:
                        type: array
                        description: "[대중교통] 경로 목록"
                        items:
                          type: object
                          properties:
                            path_type:
                              type: integer
                              description: '경로 유형 (1: 지하철, 2: 버스, 3: 버스+지하철)'
                            total_time:
                              type: integer
                              description: 총 소요시간 (분)
                            total_distance:
                              type: integer
                              description: 총 거리 (m)
                            total_walk:
                              type: integer
                              description: 총 도보 거리 (m)
                            transfer_count:
                              type: integer
                              description: 환승 횟수
                            payment:
                              type: integer
                              description: 총 요금
                            sub_paths:
                              type: array
                              description: 세부 경로
                      summary:
                        type: object
                        description: "[자동차] 경로 요약"
                        properties:
                          distance:
                            type: integer
                            description: 총 거리 (m)
                          duration:
                            type: integer
                            description: 총 소요시간 (ms)
                          duration_minutes:
                            type: number
                            description: 총 소요시간 (분)
                          toll_fare:
                            type: integer
                            description: 통행료
                          taxi_fare:
                            type: integer
                            description: 예상 택시비
                          fuel_price:
                            type: integer
                            description: 예상 유류비
                      sections:
                        type: array
                        description: "[자동차] 구간 정보"
                      path:
                        type: array
                        description: "[자동차] 경로 좌표 배열"
                required:
                - mode
                - start
                - destination
                - result
        '400':
          description: 잘못된 좌표
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: 에러 메시지
                  mode:
                    type: string
                    nullable: true
        '401':
          description: 인증 실패
  "/api/v1/folders":
    get:
      summary: 모든 폴더 조회 (트리 구조)
      tags:
      - 폴더 관리
      description: 현재 사용자의 모든 폴더를 계층형 트리 구조로 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  folders:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                        description:
                          type: string
                          nullable: true
                        created_at:
                          type: string
                          format: date-time
                        updated_at:
                          type: string
                          format: date-time
                        children:
                          type: array
        '401':
          description: 인증 실패
    post:
      summary: 폴더 생성
      tags:
      - 폴더 관리
      description: 새 폴더를 생성합니다
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '201':
          description: 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  folder:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      description:
                        type: string
                        nullable: true
                      parent_id:
                        type: integer
                        nullable: true
                      parent_name:
                        type: string
                        nullable: true
                      path:
                        type: string
                      depth:
                        type: integer
                      is_root:
                        type: boolean
                      children_count:
                        type: integer
                      descendants_count:
                        type: integer
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
        '401':
          description: 인증 실패
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                folder:
                  type: object
                  properties:
                    name:
                      type: string
                      description: 폴더 이름
                    parent_id:
                      type: integer
                      nullable: true
                      description: 부모 폴더 ID (없으면 최상위 폴더)
                    description:
                      type: string
                      nullable: true
                      description: 폴더 설명
                  required:
                  - name
  "/api/v1/folders/flat":
    get:
      summary: 모든 폴더 조회 (평면 리스트)
      tags:
      - 폴더 관리
      description: 현재 사용자의 모든 폴더를 평면 리스트로 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  folders:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                        description:
                          type: string
                          nullable: true
                        parent_id:
                          type: integer
                          nullable: true
                        path:
                          type: string
                        depth:
                          type: integer
                        created_at:
                          type: string
                          format: date-time
                        updated_at:
                          type: string
                          format: date-time
  "/api/v1/folders/{id}":
    parameters:
    - name: id
      in: path
      description: 폴더 ID
      required: true
      schema:
        type: integer
    get:
      summary: 특정 폴더 상세 조회
      tags:
      - 폴더 관리
      description: 특정 폴더의 상세 정보를 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  folder:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      description:
                        type: string
                        nullable: true
                      parent_id:
                        type: integer
                        nullable: true
                      parent_name:
                        type: string
                        nullable: true
                      path:
                        type: string
                      depth:
                        type: integer
                      is_root:
                        type: boolean
                      children_count:
                        type: integer
                      descendants_count:
                        type: integer
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
        '404':
          description: 폴더 없음
    patch:
      summary: 폴더 수정
      tags:
      - 폴더 관리
      description: 폴더 정보를 수정합니다
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '200':
          description: 수정 성공
        '404':
          description: 폴더 없음
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                folder:
                  type: object
                  properties:
                    name:
                      type: string
                    parent_id:
                      type: integer
                      nullable: true
                    description:
                      type: string
                      nullable: true
    delete:
      summary: 폴더 삭제
      tags:
      - 폴더 관리
      description: 폴더를 삭제합니다 (하위 폴더도 함께 삭제됨)
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 삭제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '404':
          description: 폴더 없음
  "/api/v1/folders/{id}/children":
    parameters:
    - name: id
      in: path
      description: 폴더 ID
      required: true
      schema:
        type: integer
    get:
      summary: 하위 폴더 조회
      tags:
      - 폴더 관리
      description: 특정 폴더의 직속 하위 폴더들만 조회합니다
      security:
      - bearer_auth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  folder_id:
                    type: integer
                  folder_name:
                    type: string
                  children:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                        description:
                          type: string
                          nullable: true
                        created_at:
                          type: string
                          format: date-time
                        updated_at:
                          type: string
                          format: date-time
        '404':
          description: 폴더 없음
  "/api/v1/search":
    get:
      summary: 장소 검색
      tags:
      - 장소 검색
      description: 네이버 로컬 검색 API를 통해 장소를 검색합니다
      parameters:
      - name: query
        in: query
        required: true
        description: '검색 키워드 (예: 스타벅스 강남역)'
        schema:
          type: string
      - name: display
        in: query
        required: false
        description: '검색 결과 개수 (1-5, 기본값: 5)'
        schema:
          type: integer
      responses:
        '200':
          description: 검색 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  query:
                    type: string
                    description: 검색한 키워드
                  count:
                    type: integer
                    description: 검색 결과 개수
                  places:
                    type: array
                    items:
                      type: object
                      properties:
                        title:
                          type: string
                          description: 장소명
                        address:
                          type: string
                          description: 지번 주소
                        road_address:
                          type: string
                          description: 도로명 주소
                        category:
                          type: string
                          description: 카테고리
                        description:
                          type: string
                          description: 설명
                        telephone:
                          type: string
                          description: 전화번호
                        latitude:
                          type: number
                          format: float
                          description: 위도 (WGS84)
                        longitude:
                          type: number
                          format: float
                          description: 경도 (WGS84)
                        naver_map_url:
                          type: string
                          description: 네이버 지도 URL
                required:
                - query
                - count
                - places
        '400':
          description: 검색어 누락
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
servers:
- url: http://localhost:3000
  description: Development server
- url: https://{defaultHost}
  variables:
    defaultHost:
      default: api.example.com
  description: Production server
components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Place:
      type: object
      properties:
        id:
          type: string
          description: 네이버 장소 ID
        name:
          type: string
          description: 장소명
        address:
          type: string
          description: 지번 주소
        roadAddress:
          type: string
          description: 도로명 주소
        lat:
          type: number
          description: 위도
        lng:
          type: number
          description: 경도
        category:
          type: string
          description: 카테고리
        telephone:
          type: string
          description: 전화번호
        naverMapUrl:
          type: string
          description: 네이버 지도 URL
